# Créer des workspaces

Pour créer un Workspace, vous devez créer le composant qui l'implémente, puis enregistrer ce composant auprès du système de Workspaces.

## Le composant Workspace

Un Workspace est implémenté en tant que composant React. Tous les Workspaces reçoivent les props définies et documentées dans l'interface `DefaultPatientWorkspaceProps`, y compris `patient`, `patientUuid` et les fonctions `closeWorkspace`, `promptBeforeClosing` et `closeWorkspaceWithSavedChanges`.

Le type de props de votre Workspace doit étendre (ou être) `DefaultPatientWorkspaceProps`. Cela garantit que vous avez les bons typings pour les props que le système de Workspaces transmet.

La prop `promptBeforeClosing` sert à indiquer au système de Workspaces s'il existe des changements non enregistrés dans le formulaire. Par défaut, tout Workspace ouvert est considéré comme ayant des changements non enregistrés. Cela peut entraîner un comportement très pénible : si quelqu'un ouvre votre Workspace et clique immédiatement ailleurs, il sera averti à propos des changements non enregistrés (c'est plus sûr que l'alternative, qui consisterait par défaut à ne jamais avertir). En tant que créateur de Workspace, c'est à vous d'éviter ce comportement, en utilisant `promptBeforeClosing`.

Les Workspaces peuvent aussi recevoir des props personnalisées. Celles‑ci seront passées lors de l'appel de la [fonction de lancement](./launching-workspaces).

### Exemple de Workspace

Nous définissons un Workspace minimaliste pour le service de gastro‑dynamique de notre hôpital. Le fichier du Workspace utilise l'extension `.workspace.tsx` pour être facilement identifiable.

```ts copy
// gastrodynamics.workspace.tsx
import React, { useEffect, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { Button, ButtonSet, Form, TextInput } from '@carbon/react';
import { type DefaultPatientWorkspaceProps } from '@openmrs/esm-patient-common-lib';
import { postGastrodynamicsForm } from './gastrodynamics.resource';
import styles from './gastrodynamics-form.module.scss';

export function GastrodynamicsForm({ patientUuid, closeWorkspace, promptBeforeClosing }: DefaultPatientWorkspaceProps) {
  const { t } = useTranslation();
  const [textValue, setTextValue] = useState('');

  useEffect(() => {
    promptBeforeClosing(() => textValue.length > 0);
  }, [textValue])

  const handleSubmit = (e) => {
    e.preventDefault();
    postGastrodynamicsForm(patientUuid, textValue, new AbortController());
  };

  return (
    <Form className={styles.form}>
      <TextInput
        id="howsThePlumbing"
        labelText={t('howsThePlumbing', "How's the plumbing?")}
        onChange={(event) => setTextValue(event.target.value)}
        value={textValue}
      />
      <ButtonSet>
        <Button className={styles.button} kind="secondary" onClick={closeWorkspace}>
          {t('discard', 'Discard')}
        </Button>
        <Button onClick={handleSubmit} className={styles.button} kind="primary">
          {t('submit', 'Submit')}
        </Button>
      </ButtonSet>
    </Form>
  );
};
```

## Enregistrer un Workspace

L'enregistrement permet au système de Workspaces de connaître le nouveau Workspace. Une fois enregistré, il peut être [lancé](./launching-workspaces).

Notre nouveau Workspace peut être enregistré dans le fichier `index.ts`, en utilisant la fonction `registerWorkspace` de `@openmrs/esm-patient-common-lib`. Les paramètres de `registerWorkspace` sont documentés dans l'interface `WorkspaceRegistration`.

Notez que même si les paramètres de `registerWorkspace` permettent une certaine flexibilité de comportement, vous devriez généralement viser un Workspace conforme à l'une des [variantes](https://zeroheight.com/23a080e38/p/483a22-workspace) conçues.

## Exemple d'enregistrement

Voici un exemple qui serait placé dans le fichier index de l'application. Nous supposons que l'application s'appelle `@myorg/esm-gastrodynamics-app`.

```ts copy
// index.ts
import { registerWorkspace } from '@openmrs/esm-patient-common-lib';

export function startupApp() {
  registerWorkspace({
    name: 'gastrodynamics-form',
    title: translateFrom('@myorg/esm-gastrodynamics-app', 'gastrodynamicsTitle', 'Gastrodynamics'),
    load: getAsyncLifecycle(() => import('./gastrodynamics.workspace'), options),
    type: 'other-form',
    canHide: false,
    canMaximize: true,
    width: 'narrow',
    preferredWindowSize: 'maximized'
  });
}
```
