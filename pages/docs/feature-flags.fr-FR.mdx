import Image from "next/image";

# Drapeaux de fonctionnalité

Les fonctionnalités en cours de développement peuvent être cachées derrière des feature flags. C’est utile pour des fonctionnalités complexes qui nécessitent du temps et plusieurs itérations avant d’être entièrement prêtes.

Un feature flag peut être activé ou désactivé depuis l’onglet « Feature Flags » des Implementer Tools. Le flag est activé ou désactivé pour cet utilisateur, dans son navigateur. Les feature flags ne sont pas persistés côté serveur : ils ne permettent donc pas de déploiement progressif, et ne sont pas accessibles aux non‑administrateurs. Pour les utilisateurs sans accès aux Implementer Tools, les éléments masqués par des feature flags ne sont tout simplement pas disponibles.

L’API des feature flags se trouve dans les [API Docs](https://github.com/openmrs/openmrs-esm-core/blob/main/packages/framework/esm-framework/docs/API.md#feature-flags-functions).

## Utiliser les feature flags

Supposons que vous ayez construit une page pour une clinique d’optométrie laser et que vous ajoutiez une fonctionnalité pour un service à venir : offrir des yeux laser. Cette fonctionnalité est contenue dans le composant `LaserEyeInstallation`. Nous allons créer un feature flag appelé `laser-eyes`, qui permettra aux administrateurs de prévisualiser le composant avant son déploiement pour tout le monde.

Il y a deux étapes : enregistrer le feature flag avec `registerFeatureFlag`, puis l’utiliser avec `useFeatureFlag`. On commence par enregistrer le flag dans la fonction `startupApp` du module frontend sur lequel on travaille.

```ts
import { registerFeatureFlag } from "@openmrs/esm-framework";

export function startupApp() {
  registerFeatureFlag(
    "laser-eyes",
    "Laser Eye Installation Service",
    "Adds a form and relevant patient diagnostic information relating to the planned Laser Eye Installation Service to the laser optometry clinic management page."
  );
}
```

Le feature flag apparaîtra alors dans les Implementer Tools comme ci‑dessous :

<br />

<Image
  src="/feature-flag.png"
  alt="Capture d'écran de l'onglet Feature Flags des Implementer Tools montrant le toggle du feature flag Laser Eye Installation Service"
  width={1000}
  height={746}
/>

Une fois le feature flag enregistré, on peut l’utiliser pour contrôler la visibilité du composant `LaserEyeInstallation`.

```tsx
import { useFeatureFlag } from "@openmrs/esm-framework";

export default function LaserOptometryClinicManagement() {
  const isLaserEyeInstallationEnabled = useFeatureFlag("laser-eyes");

  return (
    <div>
      <h1>Laser Optometry Clinic</h1>
      <AstygmatismTreatment />
      <MyopiaTreatment />

      {/* Work in progress */}
      {isLaserEyeInstallationEnabled ? <LaserEyeInstallation /> : null}
    </div>
  );
}
```

Vous pouvez maintenant déployer des changements dans l’app d’optométrie laser qui incluent ce code en cours, sans que les utilisateurs ne voient la fonctionnalité masquée par le flag. Les administrateurs, eux, pourront ouvrir les Implementer Tools et activer/désactiver le feature flag « Laser Eye Installation Service » afin de prévisualiser la fonctionnalité.

Voici une vidéo explicative sur les feature flags par Brandon :

<br />
<iframe
  width="560"
  height="315"
  src="https://www.youtube.com/embed/BakFi1FmM0U?si=ZX9QN1R12U8_hWNX"
  title="YouTube video player"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  allowFullScreen
/>
